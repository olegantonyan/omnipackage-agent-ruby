#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optparse'
require 'pathname'

$LOAD_PATH.append(Pathname.new(__dir__).join('..', 'lib'))

require 'agent'

options = {}
optparser = OptionParser.new do |parser|
  parser.banner = "Usage: #{$PROGRAM_NAME} [options]"

  parser.on('--version', 'show version') do
    puts Agent::VERSION
    exit
  end
  parser.on('--help', 'show help info') do
    puts parser
    exit
  end
  parser.on('--[no-]headless', 'run agent without cloud connection')
  parser.on('--source SOURCE_PATH', 'path to source code in headless mode')
end
optparser.parse!(into: options)

# pp options
# Dir.chdir(__dir__)

begin
  Agent.run(options)
rescue StandardError
  puts optparser
  exit(1)
end
